blueprint:
  name: "VPD and Temperature-Based Control of Humidifier, Cooler, Heater, and Dehumidifier"
  description: >
    This blueprint controls a humidifier, a cooler, a heater, and a dehumidifier as simple On/Off switches,
    each independently, based on the current VPD value (in kPa), temperature (in ¬∞C), and humidity (%).
    The cooler is activated by high temperature even if the VPD value is within the normal range.
  domain: automation

  input:
    vpd_sensor:
      name: VPD Sensor
      description: "The entity that provides the current VPD value in kPa."
      selector:
        entity:
          domain: sensor
    temperature_sensor:
      name: Temperature Sensor
      description: "The entity that provides the current temperature."
      selector:
        entity:
          domain: sensor
    humidity_sensor:
      name: Humidity Sensor
      description: "The entity that provides the current humidity."
      selector:
        entity:
          domain: sensor
    humidifier:
      name: Humidifier Switch
      description: "Switch entity for the humidifier."
      selector:
        entity:
          domain: switch
    cooler:
      name: Cooler Switch
      description: "Switch entity for the cooler."
      selector:
        entity:
          domain: switch
    heater:
      name: Heater Switch
      description: "Switch entity for the heater."
      selector:
        entity:
          domain: switch
    dehumidifier:
      name: Dehumidifier Switch
      description: "Switch entity for the dehumidifier."
      selector:
        entity:
          domain: switch
    humidifier_turn_on_threshold:
      name: "Humidifier: Turn-On Threshold (kPa)"
      default: 1.0
      selector:
        number:
          min: 0
          max: 5
          step: 0.01
    humidifier_turn_off_threshold:
      name: "Humidifier: Turn-Off Threshold (kPa)"
      default: 0.9
      selector:
        number:
          min: 0
          max: 5
          step: 0.01
    cooler_turn_on_threshold:
      name: "Cooler: Turn-On Threshold (kPa)"
      default: 1.2
      selector:
        number:
          min: 0
          max: 5
          step: 0.01
    cooler_turn_off_threshold:
      name: "Cooler: Turn-Off Threshold (kPa)"
      default: 1.1
      selector:
        number:
          min: 0
          max: 5
          step: 0.01
    temperature_cooler_threshold:
      name: "Temperature Threshold for Cooler (¬∞C)"
      default: 28
      selector:
        number:
          min: 15
          max: 40
          step: 0.1
    temperature_cooler_off_threshold:
      name: "Temperature Turn-Off Threshold for Cooler (¬∞C)"
      default: 27
      selector:
        number:
          min: 15
          max: 40
          step: 0.1
    heater_turn_on_threshold:
      name: "Heater: Turn-On Threshold (¬∞C)"
      default: 20
      selector:
        number:
          min: 10
          max: 30
          step: 0.1
    heater_turn_off_threshold:
      name: "Heater: Turn-Off Threshold (¬∞C)"
      default: 22
      selector:
        number:
          min: 10
          max: 30
          step: 0.1
    dehumidifier_turn_on_threshold:
      name: "Dehumidifier: Turn-On Threshold (%)"
      default: 70
      selector:
        number:
          min: 40
          max: 90
          step: 1
    dehumidifier_turn_off_threshold:
      name: "Dehumidifier: Turn-Off Threshold (%)"
      default: 65
      selector:
        number:
          min: 40
          max: 90
          step: 1

trigger:
  - platform: state
    entity_id: !input vpd_sensor
  - platform: state
    entity_id: !input temperature_sensor
  - platform: state
    entity_id: !input humidity_sensor
  - platform: time_pattern
    seconds: "/10"

action:
  # üå´Ô∏è Humidifier Control
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: !input vpd_sensor
            above: !input humidifier_turn_on_threshold
        sequence:
          - service: switch.turn_on
            target:
              entity_id: !input humidifier
      - conditions:
          - condition: numeric_state
            entity_id: !input vpd_sensor
            below: !input humidifier_turn_off_threshold
        sequence:
          - service: switch.turn_off
            target:
              entity_id: !input humidifier

  # ‚ùÑÔ∏è Cooler Control (VPD- and Temperature-Based)
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: !input vpd_sensor
            above: !input cooler_turn_on_threshold
        sequence:
          - service: switch.turn_on
            target:
              entity_id: !input cooler
      - conditions:
          - condition: numeric_state
            entity_id: !input temperature_sensor
            above: !input temperature_cooler_threshold
        sequence:
          - service: switch.turn_on
            target:
              entity_id: !input cooler
      - conditions:
          - condition: numeric_state
            entity_id: !input temperature_sensor
            below: !input temperature_cooler_off_threshold
          - condition: numeric_state
            entity_id: !input vpd_sensor
            below: !input cooler_turn_on_threshold
        sequence:
          - service: switch.turn_off
            target:
              entity_id: !input cooler

  # üî• Heater Control
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: !input temperature_sensor
            below: !input heater_turn_on_threshold
        sequence:
          - service: switch.turn_on
            target:
              entity_id: !input heater
      - conditions:
          - condition: numeric_state
            entity_id: !input temperature_sensor
            above: !input heater_turn_off_threshold
        sequence:
          - service: switch.turn_off
            target:
              entity_id: !input heater

  # üí® Dehumidifier Control
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: !input humidity_sensor
            above: !input dehumidifier_turn_on_threshold
        sequence:
          - service: switch.turn_on
            target:
              entity_id: !input dehumidifier
      - conditions:
          - condition: numeric_state
            entity_id: !input humidity_sensor
            below: !input dehumidifier_turn_off_threshold
        sequence:
          - service: switch.turn_off
            target:
              entity_id: !input dehumidifier

mode: restart
